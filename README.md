# Convex + SvelteKit + Authentication Demo

A full-stack task management application showcasing the integration of **Convex**, **SvelteKit**, and **@convex-dev/auth** for a complete authentication and real-time data solution.

## Features

- ✅ **Real-time task management** with Convex database
- 🔐 **Multi-provider authentication** using @convex-dev/auth (Google OAuth + Email/Password)
- 🎨 **Modern UI** with Tailwind CSS
- ⚡ **Real-time updates** - changes sync instantly across sessions
- 🔒 **User-specific data** - each user sees only their own tasks
- 📱 **Responsive design** - works on desktop and mobile

## Tech Stack

- **Frontend**: SvelteKit 2 + TypeScript + Tailwind CSS
- **Backend**: Convex (database + real-time + serverless functions)
- **Authentication**: @convex-dev/auth with Google OAuth + password providers
- **Build Tool**: Vite
- **Testing**: Vitest + Testing Library

## Project Structure

```
src/
├── convex/              # Convex backend functions
│   ├── auth.config.ts   # Auth configuration
│   ├── auth.ts          # Auth actions
│   ├── schema.ts        # Database schema
│   ├── tasks.ts         # Task CRUD operations
│   └── users.ts         # User profile queries
├── lib/
│   ├── auth.ts          # Client-side auth utilities
│   ├── SimpleAuth.svelte # Authentication component
│   └── TaskForm.svelte  # Task creation form
└── routes/
    ├── +layout.svelte   # Convex client setup
    └── +page.svelte     # Main application page
```

## Quick Start

### 1. Clone and Install

```bash
git clone <your-repo-url>
cd convex-svelte-test
npm install
```

### 2. Set up Convex Backend

```bash
# Login to Convex and create a new project
npx convex dev
```

This will:

- Create a new Convex project
- Generate basic environment variables
- Start the Convex dev server
- Watch for changes to your Convex functions

### 3. Configure Authentication

⚠️ **Important**: Authentication requires additional setup for Google OAuth to work properly.

**Quick Setup (Email/Password only):**

- The app will work with email/password authentication out of the box
- JWT keys will be auto-generated on first sign-in attempt

**Full Setup (Google OAuth + Email/Password):**

- Follow the detailed [Authentication Setup Guide](./docs/AUTHENTICATION_SETUP.md)
- Configure Google Cloud Console OAuth credentials
- Set required Convex environment variables

### 4. Start Development Server

```bash
npm run dev
```

Open [http://localhost:5174](http://localhost:5174) to see the application.

## Authentication Setup

This project supports two authentication methods:

1. **📧 Email/Password Authentication** - Works immediately after `npx convex dev`
2. **🔐 Google OAuth Authentication** - Requires Google Cloud Console setup

### Required for Google OAuth

To enable Google sign-in, you need to configure these Convex environment variables:

- `AUTH_GOOGLE_ID` - Google OAuth Client ID
- `AUTH_GOOGLE_SECRET` - Google OAuth Client Secret
- `SITE_URL` - Your application URL (e.g., `http://localhost:5174`)

**📚 Complete Setup Guide:** See [docs/AUTHENTICATION_SETUP.md](./docs/AUTHENTICATION_SETUP.md) for detailed step-by-step instructions including:

- Google Cloud Console configuration
- OAuth redirect URI setup
- Environment variable configuration
- Troubleshooting common issues
- Production deployment considerations

## Key Integration Points

### Authentication Setup

The app uses @convex-dev/auth with multiple providers:

```typescript
// convex/auth.ts
export const { auth, signIn, signOut, store } = convexAuth({
  providers: [
    Password, // Email/password authentication
    Google, // Google OAuth authentication
  ],
});
```

### Real-time Data with Convex

Tasks are stored in Convex and update in real-time:

```typescript
// In Svelte components
const tasksQuery = useQuery(api.tasks.get, {});
const userQuery = useQuery(api.users.getUserProfile, {});
```

### User-specific Data Security

All task operations verify user authentication:

```typescript
// convex/tasks.ts
export const get = query({
  handler: async (ctx) => {
    const userId = await getAuthUserId(ctx);
    if (!userId) return [];

    return await ctx.db
      .query("tasks")
      .filter((q) => q.eq(q.field("userId"), userId))
      .collect();
  },
});
```

## Available Scripts

- `npm run dev` - Start development server
- `npm run build` - Build for production
- `npm run preview` - Preview production build
- `npm run check` - Type check
- `npm run lint` - Run ESLint and Prettier
- `npm test` - Run tests
- `npx convex dev` - Start Convex development

## Environment Variables

### Auto-Generated by Convex

After running `npx convex dev`, you'll have:

```env
# Generated by Convex CLI
CONVEX_DEPLOYMENT=dev:your-deployment-name
PUBLIC_CONVEX_URL=https://your-deployment.convex.cloud
```

### Required for Google OAuth

Set these in your Convex deployment (via dashboard or CLI):

```env
# Google OAuth credentials (from Google Cloud Console)
AUTH_GOOGLE_ID=your-google-client-id.apps.googleusercontent.com
AUTH_GOOGLE_SECRET=GOCSPX-your-google-client-secret

# Your application URL
SITE_URL=http://localhost:5174  # Development
# SITE_URL=https://your-domain.com  # Production
```

### Auto-Generated by Auth System

These are created automatically on first authentication:

```env
# JWT signing and verification (auto-generated)
JWKS={"keys":[...]}
JWT_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----...
```

**📚 Documentation:**

- **🚀 Quick Setup:** [docs/QUICK_SETUP.md](./docs/QUICK_SETUP.md) - Fast setup for common scenarios
- **🔐 Complete Auth Guide:** [docs/AUTHENTICATION_SETUP.md](./docs/AUTHENTICATION_SETUP.md) - Detailed setup instructions
- **📋 Setup Status:** [docs/CONVEX_AUTH_SETUP.md](./docs/CONVEX_AUTH_SETUP.md) - Current implementation details

## Deployment

1. **Deploy Convex backend:**

   ```bash
   npx convex deploy --cmd 'npm run build'
   ```

2. **Deploy frontend to your preferred platform** (Vercel, Netlify, etc.)

## Learn More

- [Convex Documentation](https://docs.convex.dev)
- [SvelteKit Documentation](https://kit.svelte.dev)
- [@convex-dev/auth Documentation](https://labs.convex.dev/auth)
- [Tailwind CSS Documentation](https://tailwindcss.com)

## License

MIT
